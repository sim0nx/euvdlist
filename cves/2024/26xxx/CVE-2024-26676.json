{
  "id": "EUVD-2024-23938",
  "description": "In the Linux kernel, the following vulnerability has been resolved:\n\naf_unix: Call kfree_skb() for dead unix_(sk)->oob_skb in GC.\n\nsyzbot reported a warning [0] in __unix_gc() with a repro, which\ncreates a socketpair and sends one socket's fd to itself using the\npeer.\n\n  socketpair(AF_UNIX, SOCK_STREAM, 0, [3, 4]) = 0\n  sendmsg(4, {msg_name=NULL, msg_namelen=0, msg_iov=[{iov_base=\"\\360\", iov_len=1}],\n          msg_iovlen=1, msg_control=[{cmsg_len=20, cmsg_level=SOL_SOCKET,\n                                      cmsg_type=SCM_RIGHTS, cmsg_data=[3]}],\n          msg_controllen=24, msg_flags=0}, MSG_OOB|MSG_PROBE|MSG_DONTWAIT|MSG_ZEROCOPY) = 1\n\nThis forms a self-cyclic reference that GC should finally untangle\nbut does not due to lack of MSG_OOB handling, resulting in memory\nleak.\n\nRecently, commit 11498715f266 (\"af_unix: Remove io_uring code for\nGC.\") removed io_uring's dead code in GC and revealed the problem.\n\nThe code was executed at the final stage of GC and unconditionally\nmoved all GC candidates from gc_candidates to gc_inflight_list.\nThat papered over the reported problem by always making the following\nWARN_ON_ONCE(!list_empty(&gc_candidates)) false.\n\nThe problem has been there since commit 2aab4b969002 (\"af_unix: fix\nstruct pid leaks in OOB support\") added full scm support for MSG_OOB\nwhile fixing another bug.\n\nTo fix this problem, we must call kfree_skb() for unix_sk(sk)->oob_skb\nif the socket still exists in gc_candidates after purging collected skb.\n\nThen, we need to set NULL to oob_skb before calling kfree_skb() because\nit calls last fput() and triggers unix_release_sock(), where we call\nduplicate kfree_skb(u->oob_skb) if not NULL.\n\nNote that the leaked socket remained being linked to a global list, so\nkmemleak also could not detect it.  We need to check /proc/net/protocol\nto notice the unfreed socket.\n\n[0]:\nWARNING: CPU: 0 PID: 2863 at net/unix/garbage.c:345 __unix_gc+0xc74/0xe80 net/unix/garbage.c:345\nModules linked in:\nCPU: 0 PID: 2863 Comm: kworker/u4:11 Not tainted 6.8.0-rc1-syzkaller-00583-g1701940b1a02 #0\nHardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 01/25/2024\nWorkqueue: events_unbound __unix_gc\nRIP: 0010:__unix_gc+0xc74/0xe80 net/unix/garbage.c:345\nCode: 8b 5c 24 50 e9 86 f8 ff ff e8 f8 e4 22 f8 31 d2 48 c7 c6 30 6a 69 89 4c 89 ef e8 97 ef ff ff e9 80 f9 ff ff e8 dd e4 22 f8 90 <0f> 0b 90 e9 7b fd ff ff 48 89 df e8 5c e7 7c f8 e9 d3 f8 ff ff e8\nRSP: 0018:ffffc9000b03fba0 EFLAGS: 00010293\nRAX: 0000000000000000 RBX: ffffc9000b03fc10 RCX: ffffffff816c493e\nRDX: ffff88802c02d940 RSI: ffffffff896982f3 RDI: ffffc9000b03fb30\nRBP: ffffc9000b03fce0 R08: 0000000000000001 R09: fffff52001607f66\nR10: 0000000000000003 R11: 0000000000000002 R12: dffffc0000000000\nR13: ffffc9000b03fc10 R14: ffffc9000b03fc10 R15: 0000000000000001\nFS:  0000000000000000(0000) GS:ffff8880b9400000(0000) knlGS:0000000000000000\nCS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033\nCR2: 00005559c8677a60 CR3: 000000000d57a000 CR4: 00000000003506f0\nDR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000\nDR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400\nCall Trace:\n <TASK>\n process_one_work+0x889/0x15e0 kernel/workqueue.c:2633\n process_scheduled_works kernel/workqueue.c:2706 [inline]\n worker_thread+0x8b9/0x12a0 kernel/workqueue.c:2787\n kthread+0x2c6/0x3b0 kernel/kthread.c:388\n ret_from_fork+0x45/0x80 arch/x86/kernel/process.c:147\n ret_from_fork_asm+0x1b/0x30 arch/x86/entry/entry_64.S:242\n </TASK>",
  "datePublished": "Apr 2, 2024, 7:01:40 AM",
  "dateUpdated": "May 7, 2025, 8:01:37 PM",
  "baseScore": 5.5,
  "baseScoreVersion": "3.1",
  "baseScoreVector": "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H",
  "references": [
    "https://git.kernel.org/stable/c/4fe505c63aa3273135a57597fda761e9aecc7668",
    "https://git.kernel.org/stable/c/e0e09186d8821ad59806115d347ea32efa43ca4b",
    "https://git.kernel.org/stable/c/b74aa9ce13d02b7fd37c5325b99854f91b9b4276",
    "https://git.kernel.org/stable/c/82ae47c5c3a6b27fdc0f9e83c1499cb439c56140",
    "https://git.kernel.org/stable/c/1279f9d9dec2d7462823a18c29ad61359e0a007d"
  ],
  "aliases": [
    "CVE-2024-26676",
    "GSD-2024-26676"
  ],
  "assigner": "Linux",
  "epss": 0.01,
  "enisaIdProduct": [
    {
      "id": "257d33ff-8c14-334d-b799-c05a3f86db9d",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 0"
    },
    {
      "id": "290fab8e-3b78-3b46-b54b-b1eb81350971",
      "product": {
        "name": "Linux"
      },
      "product_version": "f3969427fb06a2c3cd6efd7faab63505cfa76e76 <4fe505c63aa3273135a57597fda761e9aecc7668"
    },
    {
      "id": "2b454e4b-4060-3519-9299-74b33a705f34",
      "product": {
        "name": "Linux"
      },
      "product_version": "a59d6306263c38e5c0592ea4451ca26a0778c947"
    },
    {
      "id": "35a2aa16-8fbe-3550-a1d0-656cbc420c9c",
      "product": {
        "name": "Linux"
      }
    },
    {
      "id": "37cb8388-1f14-3b1c-a976-81298b1af6a8",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 6.1.78"
    },
    {
      "id": "3ea3f8a9-881b-34a2-9c19-6ae10cd7846e",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 6.6.17"
    },
    {
      "id": "4c5529f4-d0e4-3fab-9fda-ec0ba0659715",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 6.7.5"
    },
    {
      "id": "6c09ac20-e72a-3ccd-ba06-606af7d685d2",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 5.15.149"
    },
    {
      "id": "7401aaa4-0235-3735-814e-a75bc7bdcf8c",
      "product": {
        "name": "Linux"
      },
      "product_version": "ac1968ac399205fda9ee3b18f7de7416cb3a5d0d <e0e09186d8821ad59806115d347ea32efa43ca4b"
    },
    {
      "id": "84c586e4-303d-380c-980a-9516490a9ecb",
      "product": {
        "name": "Linux"
      },
      "product_version": "2aab4b96900272885bc157f8b236abf1cdc02e08 <b74aa9ce13d02b7fd37c5325b99854f91b9b4276"
    },
    {
      "id": "ad6e3a46-6eca-35e6-8488-6f92d937fdb5",
      "product": {
        "name": "Linux"
      },
      "product_version": "6.3"
    },
    {
      "id": "c00c8742-7b28-3c06-9e14-893c3cb2cc1e",
      "product": {
        "name": "Linux"
      },
      "product_version": "2aab4b96900272885bc157f8b236abf1cdc02e08 <82ae47c5c3a6b27fdc0f9e83c1499cb439c56140"
    },
    {
      "id": "d606807b-d85b-30c0-991e-0cb3070e8b1c",
      "product": {
        "name": "Linux"
      },
      "product_version": "2aab4b96900272885bc157f8b236abf1cdc02e08 <1279f9d9dec2d7462823a18c29ad61359e0a007d"
    },
    {
      "id": "f9925ea8-84af-3499-8429-67bf5139de95",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 6.8"
    }
  ],
  "enisaIdVendor": [
    {
      "id": "35a2aa16-8fbe-3550-a1d0-656cbc420c9c",
      "vendor": {
        "name": "Linux"
      }
    }
  ],
  "cve": "CVE-2024-26676"
}

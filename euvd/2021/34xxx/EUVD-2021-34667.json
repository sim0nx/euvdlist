{
  "id": "EUVD-2021-34667",
  "enisaUuid": "33893206-87ba-362d-8e51-a6293e0b8e5b",
  "description": "In the Linux kernel, the following vulnerability has been resolved:\n\nubifs: Fix deadlock in concurrent rename whiteout and inode writeback\n\nFollowing hung tasks:\n[   77.028764] task:kworker/u8:4    state:D stack:    0 pid:  132\n[   77.028820] Call Trace:\n[   77.029027]  schedule+0x8c/0x1b0\n[   77.029067]  mutex_lock+0x50/0x60\n[   77.029074]  ubifs_write_inode+0x68/0x1f0 [ubifs]\n[   77.029117]  __writeback_single_inode+0x43c/0x570\n[   77.029128]  writeback_sb_inodes+0x259/0x740\n[   77.029148]  wb_writeback+0x107/0x4d0\n[   77.029163]  wb_workfn+0x162/0x7b0\n\n[   92.390442] task:aa              state:D stack:    0 pid: 1506\n[   92.390448] Call Trace:\n[   92.390458]  schedule+0x8c/0x1b0\n[   92.390461]  wb_wait_for_completion+0x82/0xd0\n[   92.390469]  __writeback_inodes_sb_nr+0xb2/0x110\n[   92.390472]  writeback_inodes_sb_nr+0x14/0x20\n[   92.390476]  ubifs_budget_space+0x705/0xdd0 [ubifs]\n[   92.390503]  do_rename.cold+0x7f/0x187 [ubifs]\n[   92.390549]  ubifs_rename+0x8b/0x180 [ubifs]\n[   92.390571]  vfs_rename+0xdb2/0x1170\n[   92.390580]  do_renameat2+0x554/0x770\n\n, are caused by concurrent rename whiteout and inode writeback processes:\n\trename_whiteout(Thread 1)\t        wb_workfn(Thread2)\nubifs_rename\n  do_rename\n    lock_4_inodes (Hold ui_mutex)\n    ubifs_budget_space\n      make_free_space\n        shrink_liability\n\t  __writeback_inodes_sb_nr\n\t    bdi_split_work_to_wbs (Queue new wb work)\n\t\t\t\t\t      wb_do_writeback(wb work)\n\t\t\t\t\t\t__writeback_single_inode\n\t\t\t\t\t          ubifs_write_inode\n\t\t\t\t\t            LOCK(ui_mutex)\n\t\t\t\t\t\t\t   \u2191\n\t      wb_wait_for_completion (Wait wb work) <-- deadlock!\n\nReproducer (Detail program in [Link]):\n  1. SYS_renameat2(\"/mp/dir/file\", \"/mp/dir/whiteout\", RENAME_WHITEOUT)\n  2. Consume out of space before kernel(mdelay) doing budget for whiteout\n\nFix it by doing whiteout space budget before locking ubifs inodes.\nBTW, it also fixes wrong goto tag 'out_release' in whiteout budget\nerror handling path(It should at least recover dir i_size and unlock\n4 ubifs inodes).",
  "datePublished": "Feb 26, 2025, 1:54:10 AM",
  "dateUpdated": "Oct 1, 2025, 7:57:08 PM",
  "baseScore": 5.5,
  "baseScoreVersion": "3.1",
  "baseScoreVector": "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H",
  "references": [
    "https://git.kernel.org/stable/c/9dddc8211430fb851ddf0b168e3a00c6f66cc185",
    "https://git.kernel.org/stable/c/37bdf1ad592555ecda1d55b89f6e393e4c0589d1",
    "https://git.kernel.org/stable/c/83e42a78428fc354f5e2049935b84c8d8d29b787",
    "https://git.kernel.org/stable/c/c58af8564a7b08757173009030b74baf4b2b762b",
    "https://git.kernel.org/stable/c/70e9090acc32348cedc5def0cd6d5c126efc97b9",
    "https://git.kernel.org/stable/c/8b278c8dcfb565cb65eceb62a38cbf7a7c326db5",
    "https://git.kernel.org/stable/c/afd427048047e8efdedab30e8888044e2be5aa9c",
    "https://nvd.nist.gov/vuln/detail/CVE-2021-47637"
  ],
  "aliases": [
    "CVE-2021-47637"
  ],
  "assigner": "Linux",
  "epss": 0.02,
  "enisaIdProduct": [
    {
      "id": "0904348b-415b-3160-94a0-5ffbb85e8641",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 5.15.33"
    },
    {
      "id": "30b97a8d-404c-355a-9b37-8b569d7eb91b",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 5.18"
    },
    {
      "id": "5a2bcc60-08b2-365f-af0c-48d5efbfdda1",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 5.16.19"
    },
    {
      "id": "5df748e6-b20c-38f4-8de2-a7a5420106cf",
      "product": {
        "name": "Linux"
      },
      "product_version": "9e0a1fff8db56eaaebb74b4a3ef65f86811c4798 <afd427048047e8efdedab30e8888044e2be5aa9c"
    },
    {
      "id": "606ed33e-0081-3372-bf92-5c93b46efd71",
      "product": {
        "name": "Linux"
      },
      "product_version": "9e0a1fff8db56eaaebb74b4a3ef65f86811c4798 <37bdf1ad592555ecda1d55b89f6e393e4c0589d1"
    },
    {
      "id": "704df943-0eff-332b-9765-4ebeea8f6600",
      "product": {
        "name": "Linux"
      },
      "product_version": "9e0a1fff8db56eaaebb74b4a3ef65f86811c4798 <70e9090acc32348cedc5def0cd6d5c126efc97b9"
    },
    {
      "id": "c555052f-5416-3b52-b8fc-515a255620df",
      "product": {
        "name": "Linux"
      },
      "product_version": "4.9"
    },
    {
      "id": "c68729ce-fa12-35e7-ae57-423aa91b1a9e",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 5.17.2"
    },
    {
      "id": "c7c05ef3-968d-3e30-aa7d-985e96c5868f",
      "product": {
        "name": "Linux"
      },
      "product_version": "9e0a1fff8db56eaaebb74b4a3ef65f86811c4798 <8b278c8dcfb565cb65eceb62a38cbf7a7c326db5"
    },
    {
      "id": "d4e60fb6-de9a-378e-ae41-f0e231375837",
      "product": {
        "name": "Linux"
      },
      "product_version": "9e0a1fff8db56eaaebb74b4a3ef65f86811c4798 <9dddc8211430fb851ddf0b168e3a00c6f66cc185"
    },
    {
      "id": "d53d90be-7dbd-3a9a-af9f-266d7266dfcc",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 0"
    },
    {
      "id": "dc972abc-3461-323c-a4dc-b2e5e952b9b6",
      "product": {
        "name": "Linux"
      },
      "product_version": "9e0a1fff8db56eaaebb74b4a3ef65f86811c4798 <c58af8564a7b08757173009030b74baf4b2b762b"
    },
    {
      "id": "e71ca0a2-0d58-37ba-9fa8-c963004c3fd8",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 4.19.238"
    },
    {
      "id": "ec1dbd4d-747a-3e3f-9a88-9091d7191805",
      "product": {
        "name": "Linux"
      },
      "product_version": "9e0a1fff8db56eaaebb74b4a3ef65f86811c4798 <83e42a78428fc354f5e2049935b84c8d8d29b787"
    },
    {
      "id": "f4155947-4728-300f-8827-f3428d094f04",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 5.10.110"
    },
    {
      "id": "ff7e170c-2fd4-32e0-9055-3a394242b08f",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 5.4.189"
    }
  ],
  "enisaIdVendor": [
    {
      "id": "36be404e-c632-3656-b8ce-eef00cbf246d",
      "vendor": {
        "name": "Linux"
      }
    }
  ]
}
{
  "id": "EUVD-2024-51867",
  "enisaUuid": "bdda70df-487d-3dd3-9956-65ab6e10ddc6",
  "description": "In the Linux kernel, the following vulnerability has been resolved:\n\nKVM: arm64: Get rid of userspace_irqchip_in_use\n\nImproper use of userspace_irqchip_in_use led to syzbot hitting the\nfollowing WARN_ON() in kvm_timer_update_irq():\n\nWARNING: CPU: 0 PID: 3281 at arch/arm64/kvm/arch_timer.c:459\nkvm_timer_update_irq+0x21c/0x394\nCall trace:\n  kvm_timer_update_irq+0x21c/0x394 arch/arm64/kvm/arch_timer.c:459\n  kvm_timer_vcpu_reset+0x158/0x684 arch/arm64/kvm/arch_timer.c:968\n  kvm_reset_vcpu+0x3b4/0x560 arch/arm64/kvm/reset.c:264\n  kvm_vcpu_set_target arch/arm64/kvm/arm.c:1553 [inline]\n  kvm_arch_vcpu_ioctl_vcpu_init arch/arm64/kvm/arm.c:1573 [inline]\n  kvm_arch_vcpu_ioctl+0x112c/0x1b3c arch/arm64/kvm/arm.c:1695\n  kvm_vcpu_ioctl+0x4ec/0xf74 virt/kvm/kvm_main.c:4658\n  vfs_ioctl fs/ioctl.c:51 [inline]\n  __do_sys_ioctl fs/ioctl.c:907 [inline]\n  __se_sys_ioctl fs/ioctl.c:893 [inline]\n  __arm64_sys_ioctl+0x108/0x184 fs/ioctl.c:893\n  __invoke_syscall arch/arm64/kernel/syscall.c:35 [inline]\n  invoke_syscall+0x78/0x1b8 arch/arm64/kernel/syscall.c:49\n  el0_svc_common+0xe8/0x1b0 arch/arm64/kernel/syscall.c:132\n  do_el0_svc+0x40/0x50 arch/arm64/kernel/syscall.c:151\n  el0_svc+0x54/0x14c arch/arm64/kernel/entry-common.c:712\n  el0t_64_sync_handler+0x84/0xfc arch/arm64/kernel/entry-common.c:730\n  el0t_64_sync+0x190/0x194 arch/arm64/kernel/entry.S:598\n\nThe following sequence led to the scenario:\n - Userspace creates a VM and a vCPU.\n - The vCPU is initialized with KVM_ARM_VCPU_PMU_V3 during\n   KVM_ARM_VCPU_INIT.\n - Without any other setup, such as vGIC or vPMU, userspace issues\n   KVM_RUN on the vCPU. Since the vPMU is requested, but not setup,\n   kvm_arm_pmu_v3_enable() fails in kvm_arch_vcpu_run_pid_change().\n   As a result, KVM_RUN returns after enabling the timer, but before\n   incrementing 'userspace_irqchip_in_use':\n   kvm_arch_vcpu_run_pid_change()\n       ret = kvm_arm_pmu_v3_enable()\n           if (!vcpu->arch.pmu.created)\n               return -EINVAL;\n       if (ret)\n           return ret;\n       [...]\n       if (!irqchip_in_kernel(kvm))\n           static_branch_inc(&userspace_irqchip_in_use);\n - Userspace ignores the error and issues KVM_ARM_VCPU_INIT again.\n   Since the timer is already enabled, control moves through the\n   following flow, ultimately hitting the WARN_ON():\n   kvm_timer_vcpu_reset()\n       if (timer->enabled)\n          kvm_timer_update_irq()\n              if (!userspace_irqchip())\n                  ret = kvm_vgic_inject_irq()\n                      ret = vgic_lazy_init()\n                          if (unlikely(!vgic_initialized(kvm)))\n                              if (kvm->arch.vgic.vgic_model !=\n                                  KVM_DEV_TYPE_ARM_VGIC_V2)\n                                      return -EBUSY;\n                  WARN_ON(ret);\n\nTheoretically, since userspace_irqchip_in_use's functionality can be\nsimply replaced by '!irqchip_in_kernel()', get rid of the static key\nto avoid the mismanagement, which also helps with the syzbot issue.",
  "datePublished": "Dec 27, 2024, 3:31:51 PM",
  "dateUpdated": "Oct 8, 2025, 3:32:25 PM",
  "baseScore": 0.0,
  "references": [
    "https://git.kernel.org/stable/c/dd2f9861f27571d47998d71e7516bf7216db0b52",
    "https://git.kernel.org/stable/c/c16e2dba39ff6ae84bb8dc9c8e0fb21d9b2f6f5c",
    "https://git.kernel.org/stable/c/fe425d5239a28c21e0c83ee7a8f4cb210d29fdb4",
    "https://git.kernel.org/stable/c/38d7aacca09230fdb98a34194fec2af597e8e20d",
    "https://nvd.nist.gov/vuln/detail/CVE-2024-53195"
  ],
  "aliases": [
    "CVE-2024-53195"
  ],
  "assigner": "Linux",
  "epss": 0.03,
  "enisaIdProduct": [
    {
      "id": "01bc6958-19ca-30bf-b76b-b39ab57aaa13",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 6.6.64"
    },
    {
      "id": "0de537e4-f423-34e8-a28f-bd5fe6ba1f6b",
      "product": {
        "name": "Linux"
      },
      "product_version": "1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 <fe425d5239a28c21e0c83ee7a8f4cb210d29fdb4"
    },
    {
      "id": "40a735e4-8e3a-36c0-87ee-dbc47a93cc51",
      "product": {
        "name": "Linux"
      },
      "product_version": "1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 <dd2f9861f27571d47998d71e7516bf7216db0b52"
    },
    {
      "id": "8ba9feb0-dd9f-3a68-83a8-6f024f3584db",
      "product": {
        "name": "Linux"
      },
      "product_version": "1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 <c16e2dba39ff6ae84bb8dc9c8e0fb21d9b2f6f5c"
    },
    {
      "id": "c0078df1-cbd6-34ad-b8a7-bf0988e902f9",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 6.13"
    },
    {
      "id": "ddd4bc48-19e9-3668-8f2b-568129b55aa1",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 6.11.11"
    },
    {
      "id": "f19c4c8a-9a04-32a5-a233-f7748d222351",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 6.12.2"
    },
    {
      "id": "f6f95088-9ec0-3d2f-8f78-cd95383cf8c1",
      "product": {
        "name": "Linux"
      },
      "product_version": "1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 <38d7aacca09230fdb98a34194fec2af597e8e20d"
    }
  ],
  "enisaIdVendor": [
    {
      "id": "23a4ba72-1620-3e7a-a87c-83b9326e0ef2",
      "vendor": {
        "name": "Linux"
      }
    }
  ]
}
{
  "id": "EUVD-2025-25544",
  "enisaUuid": "051f116e-9280-35b7-b305-823c4750716f",
  "description": "In the Linux kernel, the following vulnerability has been resolved:\n\nnvmet: pci-epf: Do not complete commands twice if nvmet_req_init() fails\n\nHave nvmet_req_init() and req->execute() complete failed commands.\n\nDescription of the problem:\nnvmet_req_init() calls __nvmet_req_complete() internally upon failure,\ne.g., unsupported opcode, which calls the \"queue_response\" callback,\nthis results in nvmet_pci_epf_queue_response() being called, which will\ncall nvmet_pci_epf_complete_iod() if data_len is 0 or if dma_dir is\ndifferent from DMA_TO_DEVICE. This results in a double completion as\nnvmet_pci_epf_exec_iod_work() also calls nvmet_pci_epf_complete_iod()\nwhen nvmet_req_init() fails.\n\nSteps to reproduce:\nOn the host send a command with an unsupported opcode with nvme-cli,\nFor example the admin command \"security receive\"\n$ sudo nvme security-recv /dev/nvme0n1 -n1 -x4096\n\nThis triggers a double completion as nvmet_req_init() fails and\nnvmet_pci_epf_queue_response() is called, here iod->dma_dir is still\nin the default state of \"DMA_NONE\" as set by default in\nnvmet_pci_epf_alloc_iod(), so nvmet_pci_epf_complete_iod() is called.\nBecause nvmet_req_init() failed nvmet_pci_epf_complete_iod() is also\ncalled in nvmet_pci_epf_exec_iod_work() leading to a double completion.\nThis not only sends two completions to the host but also corrupts the\nstate of the PCI NVMe target leading to kernel oops.\n\nThis patch lets nvmet_req_init() and req->execute() complete all failed\ncommands, and removes the double completion case in\nnvmet_pci_epf_exec_iod_work() therefore fixing the edge cases where\ndouble completions occurred.",
  "datePublished": "Aug 22, 2025, 4:01:01 PM",
  "dateUpdated": "Sep 29, 2025, 5:55:39 AM",
  "baseScore": 0.0,
  "references": [
    "https://git.kernel.org/stable/c/a535c0b10060bc8c174a7964b0f98064ee0c4774",
    "https://git.kernel.org/stable/c/746d0ac5a07d5da952ef258dd4d75f0b26c96476"
  ],
  "aliases": [
    "CVE-2025-38658"
  ],
  "assigner": "Linux",
  "epss": 0.03,
  "enisaIdProduct": [
    {
      "id": "27848011-e154-34f2-a814-1eef7de32637",
      "product": {
        "name": "Linux"
      },
      "product_version": "6.14"
    },
    {
      "id": "3260022f-dbd7-3cc7-828e-a9a68dee5e49",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 6.17"
    },
    {
      "id": "475f854e-e62b-38f7-810e-d61b1ab8bcf8",
      "product": {
        "name": "Linux"
      },
      "product_version": "0faa0fe6f90ea59b10d1b0f15ce0eb0c18eff186 <a535c0b10060bc8c174a7964b0f98064ee0c4774"
    },
    {
      "id": "81b146f1-9785-3e91-aaf2-a2e38c3e28b5",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 6.16.1"
    },
    {
      "id": "89325194-e8b4-3d31-a0ce-0ca4f8808956",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 0"
    },
    {
      "id": "98297d23-36c8-3261-b331-34be84bdb4ca",
      "product": {
        "name": "Linux"
      },
      "product_version": "0faa0fe6f90ea59b10d1b0f15ce0eb0c18eff186 <746d0ac5a07d5da952ef258dd4d75f0b26c96476"
    },
    {
      "id": "98ce7bbc-87f8-3898-afe3-1c5729bd6e63",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 6.17-rc1"
    }
  ],
  "enisaIdVendor": [
    {
      "id": "10680ad1-8d54-37ba-bbda-05be244f8dfc",
      "vendor": {
        "name": "Linux"
      }
    }
  ]
}
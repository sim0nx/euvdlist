{
  "id": "EUVD-2022-54827",
  "enisaUuid": "fb2642f5-55cc-34f5-a49e-1633d249ebbb",
  "description": "In the Linux kernel, the following vulnerability has been resolved:\n\nftrace: Clean up hash direct_functions on register failures\n\nWe see the following GPF when register_ftrace_direct fails:\n\n[ ] general protection fault, probably for non-canonical address \\\n  0x200000000000010: 0000 [#1] PREEMPT SMP DEBUG_PAGEALLOC PTI\n[...]\n[ ] RIP: 0010:ftrace_find_rec_direct+0x53/0x70\n[ ] Code: 48 c1 e0 03 48 03 42 08 48 8b 10 31 c0 48 85 d2 74 [...]\n[ ] RSP: 0018:ffffc9000138bc10 EFLAGS: 00010206\n[ ] RAX: 0000000000000000 RBX: ffffffff813e0df0 RCX: 000000000000003b\n[ ] RDX: 0200000000000000 RSI: 000000000000000c RDI: ffffffff813e0df0\n[ ] RBP: ffffffffa00a3000 R08: ffffffff81180ce0 R09: 0000000000000001\n[ ] R10: ffffc9000138bc18 R11: 0000000000000001 R12: ffffffff813e0df0\n[ ] R13: ffffffff813e0df0 R14: ffff888171b56400 R15: 0000000000000000\n[ ] FS:  00007fa9420c7780(0000) GS:ffff888ff6a00000(0000) knlGS:000000000\n[ ] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033\n[ ] CR2: 000000000770d000 CR3: 0000000107d50003 CR4: 0000000000370ee0\n[ ] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000\n[ ] DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400\n[ ] Call Trace:\n[ ]  <TASK>\n[ ]  register_ftrace_direct+0x54/0x290\n[ ]  ? render_sigset_t+0xa0/0xa0\n[ ]  bpf_trampoline_update+0x3f5/0x4a0\n[ ]  ? 0xffffffffa00a3000\n[ ]  bpf_trampoline_link_prog+0xa9/0x140\n[ ]  bpf_tracing_prog_attach+0x1dc/0x450\n[ ]  bpf_raw_tracepoint_open+0x9a/0x1e0\n[ ]  ? find_held_lock+0x2d/0x90\n[ ]  ? lock_release+0x150/0x430\n[ ]  __sys_bpf+0xbd6/0x2700\n[ ]  ? lock_is_held_type+0xd8/0x130\n[ ]  __x64_sys_bpf+0x1c/0x20\n[ ]  do_syscall_64+0x3a/0x80\n[ ]  entry_SYSCALL_64_after_hwframe+0x44/0xae\n[ ] RIP: 0033:0x7fa9421defa9\n[ ] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 44 00 00 9 f8 [...]\n[ ] RSP: 002b:00007ffed743bd78 EFLAGS: 00000246 ORIG_RAX: 0000000000000141\n[ ] RAX: ffffffffffffffda RBX: 00000000069d2480 RCX: 00007fa9421defa9\n[ ] RDX: 0000000000000078 RSI: 00007ffed743bd80 RDI: 0000000000000011\n[ ] RBP: 00007ffed743be00 R08: 0000000000bb7270 R09: 0000000000000000\n[ ] R10: 00000000069da210 R11: 0000000000000246 R12: 0000000000000001\n[ ] R13: 00007ffed743c4b0 R14: 00000000069d2480 R15: 0000000000000001\n[ ]  </TASK>\n[ ] Modules linked in: klp_vm(OK)\n[ ] ---[ end trace 0000000000000000 ]---\n\nOne way to trigger this is:\n  1. load a livepatch that patches kernel function xxx;\n  2. run bpftrace -e 'kfunc:xxx {}', this will fail (expected for now);\n  3. repeat #2 => gpf.\n\nThis is because the entry is added to direct_functions, but not removed.\nFix this by remove the entry from direct_functions when\nregister_ftrace_direct fails.\n\nAlso remove the last trailing space from ftrace.c, so we don't have to\nworry about it anymore.",
  "datePublished": "Feb 26, 2025, 2:12:29 AM",
  "dateUpdated": "Feb 26, 2025, 2:12:29 AM",
  "baseScore": 0.0,
  "references": [
    "https://git.kernel.org/stable/c/82c888e51c2176a06f8b4541cf748ee81aac6e7e",
    "https://git.kernel.org/stable/c/cae2978d6907ef2c08b9b15f704e783f7c284713",
    "https://git.kernel.org/stable/c/805e87af946d8d2954171361e64d143ff37a441b",
    "https://git.kernel.org/stable/c/a0392833a178cf109a57c2a9d4d531bdfc6cd98f",
    "https://git.kernel.org/stable/c/7d54c15cb89a29a5f59e5ffc9ee62e6591769ef1"
  ],
  "aliases": [
    "CVE-2022-49402"
  ],
  "assigner": "Linux",
  "epss": 0.05,
  "enisaIdProduct": [
    {
      "id": "0aa8631e-56bb-35e7-84f8-427ea6d1ba84",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 5.19"
    },
    {
      "id": "0c45c3fb-33e4-366f-8367-9cd61baa6498",
      "product": {
        "name": "Linux"
      },
      "product_version": "763e34e74bb7d5c316015e2e39fcc8520bfd071c <a0392833a178cf109a57c2a9d4d531bdfc6cd98f"
    },
    {
      "id": "505e4097-bb7f-3224-9942-ecb61af2cf3e",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 0"
    },
    {
      "id": "51bf6c2a-74e8-3a9f-bee6-a6fa258d24d4",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 5.15.46"
    },
    {
      "id": "54a84507-8e6f-3851-b804-43dd2ae41d36",
      "product": {
        "name": "Linux"
      },
      "product_version": "763e34e74bb7d5c316015e2e39fcc8520bfd071c <82c888e51c2176a06f8b4541cf748ee81aac6e7e"
    },
    {
      "id": "5fdc7b96-06c2-3654-84a2-8afe206cc3b2",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 5.18.3"
    },
    {
      "id": "90807fca-ca86-3e35-b17f-852d27eef03e",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 5.10.121"
    },
    {
      "id": "a9fe9056-8f51-36d4-9de1-4a41b6fc8af8",
      "product": {
        "name": "Linux"
      },
      "product_version": "763e34e74bb7d5c316015e2e39fcc8520bfd071c <cae2978d6907ef2c08b9b15f704e783f7c284713"
    },
    {
      "id": "ada5a810-d413-3545-a103-dac18151ee5b",
      "product": {
        "name": "Linux"
      },
      "product_version": "763e34e74bb7d5c316015e2e39fcc8520bfd071c <805e87af946d8d2954171361e64d143ff37a441b"
    },
    {
      "id": "b146fe61-f566-31e5-8681-7f1304ad9acd",
      "product": {
        "name": "Linux"
      },
      "product_version": "763e34e74bb7d5c316015e2e39fcc8520bfd071c <7d54c15cb89a29a5f59e5ffc9ee62e6591769ef1"
    },
    {
      "id": "c0082f83-8a06-350c-8265-edb982b7c200",
      "product": {
        "name": "Linux"
      },
      "product_version": "5.5"
    },
    {
      "id": "c5cbc915-f512-379c-8940-2d49ad001c6b",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 5.17.14"
    }
  ],
  "enisaIdVendor": [
    {
      "id": "cb8a0328-fcf8-39fd-b7b1-c1afb3c8d156",
      "vendor": {
        "name": "Linux"
      }
    }
  ]
}
{
  "id": "EUVD-2025-2581",
  "enisaUuid": "5db995c3-9362-3185-a2d3-23e2c3620044",
  "description": "In the Linux kernel, the following vulnerability has been resolved:\n\nx86/fpu: Ensure shadow stack is active before \"getting\" registers\n\nThe x86 shadow stack support has its own set of registers. Those registers\nare XSAVE-managed, but they are \"supervisor state components\" which means\nthat userspace can not touch them with XSAVE/XRSTOR.  It also means that\nthey are not accessible from the existing ptrace ABI for XSAVE state.\nThus, there is a new ptrace get/set interface for it.\n\nThe regset code that ptrace uses provides an ->active() handler in\naddition to the get/set ones. For shadow stack this ->active() handler\nverifies that shadow stack is enabled via the ARCH_SHSTK_SHSTK bit in the\nthread struct. The ->active() handler is checked from some call sites of\nthe regset get/set handlers, but not the ptrace ones. This was not\nunderstood when shadow stack support was put in place.\n\nAs a result, both the set/get handlers can be called with\nXFEATURE_CET_USER in its init state, which would cause get_xsave_addr() to\nreturn NULL and trigger a WARN_ON(). The ssp_set() handler luckily has an\nssp_active() check to avoid surprising the kernel with shadow stack\nbehavior when the kernel is not ready for it (ARCH_SHSTK_SHSTK==0). That\ncheck just happened to avoid the warning.\n\nBut the ->get() side wasn't so lucky. It can be called with shadow stacks\ndisabled, triggering the warning in practice, as reported by Christina\nSchimpe:\n\nWARNING: CPU: 5 PID: 1773 at arch/x86/kernel/fpu/regset.c:198 ssp_get+0x89/0xa0\n[...]\nCall Trace:\n<TASK>\n? show_regs+0x6e/0x80\n? ssp_get+0x89/0xa0\n? __warn+0x91/0x150\n? ssp_get+0x89/0xa0\n? report_bug+0x19d/0x1b0\n? handle_bug+0x46/0x80\n? exc_invalid_op+0x1d/0x80\n? asm_exc_invalid_op+0x1f/0x30\n? __pfx_ssp_get+0x10/0x10\n? ssp_get+0x89/0xa0\n? ssp_get+0x52/0xa0\n__regset_get+0xad/0xf0\ncopy_regset_to_user+0x52/0xc0\nptrace_regset+0x119/0x140\nptrace_request+0x13c/0x850\n? wait_task_inactive+0x142/0x1d0\n? do_syscall_64+0x6d/0x90\narch_ptrace+0x102/0x300\n[...]\n\nEnsure that shadow stacks are active in a thread before looking them up\nin the XSAVE buffer. Since ARCH_SHSTK_SHSTK and user_ssp[SHSTK_EN] are\nset at the same time, the active check ensures that there will be\nsomething to find in the XSAVE buffer.\n\n[ dhansen: changelog/subject tweaks ]",
  "datePublished": "Jan 19, 2025, 12:31:24 PM",
  "dateUpdated": "Sep 24, 2025, 6:30:23 PM",
  "baseScore": 0.0,
  "references": [
    "https://git.kernel.org/stable/c/0a3a872214188e4268d31581ed0cd44508e038cf",
    "https://git.kernel.org/stable/c/6bfe1fc22f462bec87422cdcbec4d7a2f43ff01d",
    "https://git.kernel.org/stable/c/a9d9c33132d49329ada647e4514d210d15e31d81",
    "https://nvd.nist.gov/vuln/detail/CVE-2025-21632"
  ],
  "aliases": [
    "CVE-2025-21632"
  ],
  "assigner": "Linux",
  "epss": 0.03,
  "enisaIdProduct": [
    {
      "id": "09b8bd2b-0326-30f2-aeb5-e6c61edf769e",
      "product": {
        "name": "Linux"
      },
      "product_version": "2fab02b25ae7cf5f714ab456b03d9a3fe5ae98c9 <0a3a872214188e4268d31581ed0cd44508e038cf"
    },
    {
      "id": "3c361beb-967b-3835-9206-f5be4056a1e9",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 6.12.10"
    },
    {
      "id": "497595e4-2b96-3eea-a71d-922a69382b89",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 0"
    },
    {
      "id": "4c32d791-7809-3f12-9466-d8baa7bdfbee",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 6.6.72"
    },
    {
      "id": "7f8d050f-33c7-39cf-b928-abf7d29e664d",
      "product": {
        "name": "Linux"
      },
      "product_version": "6.6"
    },
    {
      "id": "9787c00e-0c35-3400-87fa-98f7ba046e55",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 6.13"
    },
    {
      "id": "a4eef13a-f839-3ce9-9e3e-51172bd06fcf",
      "product": {
        "name": "Linux"
      },
      "product_version": "2fab02b25ae7cf5f714ab456b03d9a3fe5ae98c9 <a9d9c33132d49329ada647e4514d210d15e31d81"
    },
    {
      "id": "bd0e81be-4e4d-36a0-8cee-62712738aa62",
      "product": {
        "name": "Linux"
      },
      "product_version": "2fab02b25ae7cf5f714ab456b03d9a3fe5ae98c9 <6bfe1fc22f462bec87422cdcbec4d7a2f43ff01d"
    }
  ],
  "enisaIdVendor": [
    {
      "id": "2226058e-5b69-3d45-85ef-327ce2ca351c",
      "vendor": {
        "name": "Linux"
      }
    }
  ]
}
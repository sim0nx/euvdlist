{
  "id": "EUVD-2025-5270",
  "enisaUuid": "f3309976-effa-3802-a1b2-2c46882569b0",
  "description": "In the Linux kernel, the following vulnerability has been resolved:\n\npps: Fix a use-after-free\n\nOn a board running ntpd and gpsd, I'm seeing a consistent use-after-free\nin sys_exit() from gpsd when rebooting:\n\n    pps pps1: removed\n    ------------[ cut here ]------------\n    kobject: '(null)' (00000000db4bec24): is not initialized, yet kobject_put() is being called.\n    WARNING: CPU: 2 PID: 440 at lib/kobject.c:734 kobject_put+0x120/0x150\n    CPU: 2 UID: 299 PID: 440 Comm: gpsd Not tainted 6.11.0-rc6-00308-gb31c44928842 #1\n    Hardware name: Raspberry Pi 4 Model B Rev 1.1 (DT)\n    pstate: 60000005 (nZCv daif -PAN -UAO -TCO -DIT -SSBS BTYPE=--)\n    pc : kobject_put+0x120/0x150\n    lr : kobject_put+0x120/0x150\n    sp : ffffffc0803d3ae0\n    x29: ffffffc0803d3ae0 x28: ffffff8042dc9738 x27: 0000000000000001\n    x26: 0000000000000000 x25: ffffff8042dc9040 x24: ffffff8042dc9440\n    x23: ffffff80402a4620 x22: ffffff8042ef4bd0 x21: ffffff80405cb600\n    x20: 000000000008001b x19: ffffff8040b3b6e0 x18: 0000000000000000\n    x17: 0000000000000000 x16: 0000000000000000 x15: 696e6920746f6e20\n    x14: 7369203a29343263 x13: 205d303434542020 x12: 0000000000000000\n    x11: 0000000000000000 x10: 0000000000000000 x9 : 0000000000000000\n    x8 : 0000000000000000 x7 : 0000000000000000 x6 : 0000000000000000\n    x5 : 0000000000000000 x4 : 0000000000000000 x3 : 0000000000000000\n    x2 : 0000000000000000 x1 : 0000000000000000 x0 : 0000000000000000\n    Call trace:\n     kobject_put+0x120/0x150\n     cdev_put+0x20/0x3c\n     __fput+0x2c4/0x2d8\n     ____fput+0x1c/0x38\n     task_work_run+0x70/0xfc\n     do_exit+0x2a0/0x924\n     do_group_exit+0x34/0x90\n     get_signal+0x7fc/0x8c0\n     do_signal+0x128/0x13b4\n     do_notify_resume+0xdc/0x160\n     el0_svc+0xd4/0xf8\n     el0t_64_sync_handler+0x140/0x14c\n     el0t_64_sync+0x190/0x194\n    ---[ end trace 0000000000000000 ]---\n\n...followed by more symptoms of corruption, with similar stacks:\n\n    refcount_t: underflow; use-after-free.\n    kernel BUG at lib/list_debug.c:62!\n    Kernel panic - not syncing: Oops - BUG: Fatal exception\n\nThis happens because pps_device_destruct() frees the pps_device with the\nembedded cdev immediately after calling cdev_del(), but, as the comment\nabove cdev_del() notes, fops for previously opened cdevs are still\ncallable even after cdev_del() returns. I think this bug has always\nbeen there: I can't explain why it suddenly started happening every time\nI reboot this particular board.\n\nIn commit d953e0e837e6 (\"pps: Fix a use-after free bug when\nunregistering a source.\"), George Spelvin suggested removing the\nembedded cdev. That seems like the simplest way to fix this, so I've\nimplemented his suggestion, using __register_chrdev() with pps_idr\nbecoming the source of truth for which minor corresponds to which\ndevice.\n\nBut now that pps_idr defines userspace visibility instead of cdev_add(),\nwe need to be sure the pps->dev refcount can't reach zero while\nuserspace can still find it again. So, the idr_remove() call moves to\npps_unregister_cdev(), and pps_idr now holds a reference to pps->dev.\n\n    pps_core: source serial1 got cdev (251:1)\n    <...>\n    pps pps1: removed\n    pps_core: unregistering pps1\n    pps_core: deallocating pps1",
  "datePublished": "Feb 27, 2025, 2:07:06 AM",
  "dateUpdated": "May 4, 2025, 1:01:47 PM",
  "baseScore": 7.8,
  "baseScoreVersion": "3.1",
  "baseScoreVector": "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H",
  "references": [
    "https://nvd.nist.gov/vuln/detail/CVE-2024-57979",
    "https://git.kernel.org/stable/c/7e5ee3281dc09014367f5112b6d566ba36ea2d49",
    "https://git.kernel.org/stable/c/85241f7de216f8298f6e48540ea13d7dcd100870",
    "https://git.kernel.org/stable/c/91932db1d96b2952299ce30c1c693d834d10ace6",
    "https://git.kernel.org/stable/c/c79a39dc8d060b9e64e8b0fa9d245d44befeefbe",
    "https://git.kernel.org/stable/c/cd3bbcb6b3a7caa5ce67de76723b6d8531fb7f64",
    "https://git.kernel.org/stable/c/1a7735ab2cb9747518a7416fb5929e85442dec62",
    "https://git.kernel.org/stable/c/785c78ed0d39d1717cca3ef931d3e51337b5e90e",
    "https://git.kernel.org/stable/c/c4041b6b0a7a3def8cf3f3d6120ff337bc4c40f7"
  ],
  "aliases": [
    "CVE-2024-57979",
    "GHSA-579q-3q2m-34fw"
  ],
  "assigner": "Linux",
  "epss": 0.05,
  "enisaIdProduct": [
    {
      "id": "0540b9e4-cba0-339e-b516-7bf3e89d3ac6",
      "product": {
        "name": "Linux"
      },
      "product_version": "3.9"
    },
    {
      "id": "09b90a57-462f-3047-976c-123bde62338c",
      "product": {
        "name": "Linux"
      },
      "product_version": "d953e0e837e65ecc1ddaa4f9560f7925878a0de6 <91932db1d96b2952299ce30c1c693d834d10ace6"
    },
    {
      "id": "3bb4d5a2-f862-358c-8bc9-582da8c3149b",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 5.15.179"
    },
    {
      "id": "578d98d8-bfbc-31e2-85a2-db7d10acc3df",
      "product": {
        "name": "Linux"
      },
      "product_version": "d953e0e837e65ecc1ddaa4f9560f7925878a0de6 <c4041b6b0a7a3def8cf3f3d6120ff337bc4c40f7"
    },
    {
      "id": "5e552c78-3e3d-31a1-b840-7a49d9224a57",
      "product": {
        "name": "Linux"
      },
      "product_version": "49626fbb0360332e40fd76a48cb2ba876d6134ad"
    },
    {
      "id": "626ea1b5-f8f1-3355-ba73-d16874221f8e",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 6.14"
    },
    {
      "id": "66fb25ba-6d92-39b8-8606-78f9dea7d1ac",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 6.6.76"
    },
    {
      "id": "68dc41bc-34fe-33ca-89b3-0504f1532ff5",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 6.13.2"
    },
    {
      "id": "83f3b22b-c6bc-3115-ac5c-59e2366f0b5b",
      "product": {
        "name": "Linux"
      },
      "product_version": "77327a71f9841b7dfa708195d1cb133d4ef4a989"
    },
    {
      "id": "8971c9e6-979a-32c9-8cca-4f75adba3525",
      "product": {
        "name": "Linux"
      },
      "product_version": "d953e0e837e65ecc1ddaa4f9560f7925878a0de6 <85241f7de216f8298f6e48540ea13d7dcd100870"
    },
    {
      "id": "9282650e-3d06-38f7-aec0-bf142d510f38",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 0"
    },
    {
      "id": "9ab471bb-ad97-3cc3-9e6a-72dc08a97334",
      "product": {
        "name": "Linux"
      },
      "product_version": "d953e0e837e65ecc1ddaa4f9560f7925878a0de6 <cd3bbcb6b3a7caa5ce67de76723b6d8531fb7f64"
    },
    {
      "id": "b1e4de9d-a5f2-39cd-937c-8d909dcd0a07",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 5.10.235"
    },
    {
      "id": "c4ef58fe-daf7-3708-92d2-92b464fb5ecb",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 6.12.13"
    },
    {
      "id": "cac0e212-807c-3af5-9ec0-58758fbcfa6d",
      "product": {
        "name": "Linux"
      },
      "product_version": "d953e0e837e65ecc1ddaa4f9560f7925878a0de6 <785c78ed0d39d1717cca3ef931d3e51337b5e90e"
    },
    {
      "id": "cd083958-7f66-3685-8b2d-7c3d4b06c8f2",
      "product": {
        "name": "Linux"
      },
      "product_version": "d953e0e837e65ecc1ddaa4f9560f7925878a0de6 <7e5ee3281dc09014367f5112b6d566ba36ea2d49"
    },
    {
      "id": "d294c6e8-b833-3954-8bb8-c8c0ea1317fd",
      "product": {
        "name": "Linux"
      },
      "product_version": "d953e0e837e65ecc1ddaa4f9560f7925878a0de6 <1a7735ab2cb9747518a7416fb5929e85442dec62"
    },
    {
      "id": "d90d6bf5-bc60-3901-b345-c9a45d26157d",
      "product": {
        "name": "Linux"
      },
      "product_version": "cd59fb14918a6b20c1ac8be121fa6397b97b00cb"
    },
    {
      "id": "e24f4746-d84c-3dd5-b1ac-8acec09bf023",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 6.1.129"
    },
    {
      "id": "e7b5ab8c-92ba-317c-8965-c70d2c27eacc",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 5.4.291"
    },
    {
      "id": "f7a02e2b-0d19-3388-be90-5b6e9dcca19f",
      "product": {
        "name": "Linux"
      },
      "product_version": "d953e0e837e65ecc1ddaa4f9560f7925878a0de6 <c79a39dc8d060b9e64e8b0fa9d245d44befeefbe"
    }
  ],
  "enisaIdVendor": [
    {
      "id": "fd9f7075-ceb8-301f-bfab-75cfa5d81a82",
      "vendor": {
        "name": "Linux"
      }
    }
  ]
}
{
  "id": "EUVD-2024-53247",
  "description": "In the Linux kernel, the following vulnerability has been resolved:\n\nwifi: ath10k: avoid NULL pointer error during sdio remove\n\nWhen running 'rmmod ath10k', ath10k_sdio_remove() will free sdio\nworkqueue by destroy_workqueue(). But if CONFIG_INIT_ON_FREE_DEFAULT_ON\nis set to yes, kernel panic will happen:\nCall trace:\n destroy_workqueue+0x1c/0x258\n ath10k_sdio_remove+0x84/0x94\n sdio_bus_remove+0x50/0x16c\n device_release_driver_internal+0x188/0x25c\n device_driver_detach+0x20/0x2c\n\nThis is because during 'rmmod ath10k', ath10k_sdio_remove() will call\nath10k_core_destroy() before destroy_workqueue(). wiphy_dev_release()\nwill finally be called in ath10k_core_destroy(). This function will free\nstruct cfg80211_registered_device *rdev and all its members, including\nwiphy, dev and the pointer of sdio workqueue. Then the pointer of sdio\nworkqueue will be set to NULL due to CONFIG_INIT_ON_FREE_DEFAULT_ON.\n\nAfter device release, destroy_workqueue() will use NULL pointer then the\nkernel panic happen.\n\nCall trace:\nath10k_sdio_remove\n  ->ath10k_core_unregister\n    ……\n    ->ath10k_core_stop\n      ->ath10k_hif_stop\n        ->ath10k_sdio_irq_disable\n    ->ath10k_hif_power_down\n      ->del_timer_sync(&ar_sdio->sleep_timer)\n  ->ath10k_core_destroy\n    ->ath10k_mac_destroy\n      ->ieee80211_free_hw\n        ->wiphy_free\n    ……\n          ->wiphy_dev_release\n  ->destroy_workqueue\n\nNeed to call destroy_workqueue() before ath10k_core_destroy(), free\nthe work queue buffer first and then free pointer of work queue by\nath10k_core_destroy(). This order matches the error path order in\nath10k_sdio_probe().\n\nNo work will be queued on sdio workqueue between it is destroyed and\nath10k_core_destroy() is called. Based on the call_stack above, the\nreason is:\nOnly ath10k_sdio_sleep_timer_handler(), ath10k_sdio_hif_tx_sg() and\nath10k_sdio_irq_disable() will queue work on sdio workqueue.\nSleep timer will be deleted before ath10k_core_destroy() in\nath10k_hif_power_down().\nath10k_sdio_irq_disable() only be called in ath10k_hif_stop().\nath10k_core_unregister() will call ath10k_hif_power_down() to stop hif\nbus, so ath10k_sdio_hif_tx_sg() won't be called anymore.\n\nTested-on: QCA6174 hw3.2 SDIO WLAN.RMH.4.4.1-00189",
  "datePublished": "Dec 27, 2024, 2:51:05 PM",
  "dateUpdated": "Jan 23, 2025, 5:00:48 PM",
  "baseScore": 0.0,
  "references": [
    "https://git.kernel.org/stable/c/6e5dbd1c04abf2c19b2282915e6fa48b6ccc6921",
    "https://git.kernel.org/stable/c/b35de9e01fc79c7baac666fb2dcb4ba7698a1d97",
    "https://git.kernel.org/stable/c/543c0924d446b21f35701ca084d7feca09511220",
    "https://git.kernel.org/stable/c/95c38953cb1ecf40399a676a1f85dfe2b5780a9a"
  ],
  "aliases": [
    "CVE-2024-56599"
  ],
  "assigner": "Linux",
  "epss": 0.06,
  "enisaIdProduct": [
    {
      "id": "1a1ce381-1a9b-326c-8030-b7c032dde391",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 6.6.70"
    },
    {
      "id": "1ede0a9f-7910-3076-93fd-e38e8a863fae",
      "product": {
        "name": "Linux"
      },
      "product_version": "1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 <b35de9e01fc79c7baac666fb2dcb4ba7698a1d97"
    },
    {
      "id": "3a2bb0a1-9a74-3001-aedf-400e1481857e",
      "product": {
        "name": "Linux"
      },
      "product_version": "1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 <6e5dbd1c04abf2c19b2282915e6fa48b6ccc6921"
    },
    {
      "id": "7767d002-d14b-3418-a6ea-561f7fd46dc5",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 6.13"
    },
    {
      "id": "9941b585-3041-3072-b84e-ee7053692c22",
      "product": {
        "name": "Linux"
      },
      "product_version": "1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 <95c38953cb1ecf40399a676a1f85dfe2b5780a9a"
    },
    {
      "id": "c28f483a-b720-3235-9051-42b9602d4443",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 6.12.5"
    },
    {
      "id": "f0b2b14b-0e6d-3b1e-9a86-f0e47e36013a",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 6.1.127"
    },
    {
      "id": "f5cb9c78-c7be-3af6-bb5b-6de0634b7c97",
      "product": {
        "name": "Linux"
      },
      "product_version": "1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 <543c0924d446b21f35701ca084d7feca09511220"
    }
  ],
  "enisaIdVendor": [
    {
      "id": "ec9783d4-5f4e-319d-9830-213b24d23151",
      "vendor": {
        "name": "Linux"
      }
    }
  ],
  "cve": "CVE-2024-56599"
}

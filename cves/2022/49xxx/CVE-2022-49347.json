{
  "id": "EUVD-2022-54881",
  "description": "In the Linux kernel, the following vulnerability has been resolved:\n\next4: fix bug_on in ext4_writepages\n\nwe got issue as follows:\nEXT4-fs error (device loop0): ext4_mb_generate_buddy:1141: group 0, block bitmap and bg descriptor inconsistent: 25 vs 31513 free cls\n------------[ cut here ]------------\nkernel BUG at fs/ext4/inode.c:2708!\ninvalid opcode: 0000 [#1] PREEMPT SMP KASAN PTI\nCPU: 2 PID: 2147 Comm: rep Not tainted 5.18.0-rc2-next-20220413+ #155\nRIP: 0010:ext4_writepages+0x1977/0x1c10\nRSP: 0018:ffff88811d3e7880 EFLAGS: 00010246\nRAX: 0000000000000000 RBX: 0000000000000001 RCX: ffff88811c098000\nRDX: 0000000000000000 RSI: ffff88811c098000 RDI: 0000000000000002\nRBP: ffff888128140f50 R08: ffffffffb1ff6387 R09: 0000000000000000\nR10: 0000000000000007 R11: ffffed10250281ea R12: 0000000000000001\nR13: 00000000000000a4 R14: ffff88811d3e7bb8 R15: ffff888128141028\nFS:  00007f443aed9740(0000) GS:ffff8883aef00000(0000) knlGS:0000000000000000\nCS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033\nCR2: 0000000020007200 CR3: 000000011c2a4000 CR4: 00000000000006e0\nDR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000\nDR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400\nCall Trace:\n <TASK>\n do_writepages+0x130/0x3a0\n filemap_fdatawrite_wbc+0x83/0xa0\n filemap_flush+0xab/0xe0\n ext4_alloc_da_blocks+0x51/0x120\n __ext4_ioctl+0x1534/0x3210\n __x64_sys_ioctl+0x12c/0x170\n do_syscall_64+0x3b/0x90\n\nIt may happen as follows:\n1. write inline_data inode\nvfs_write\n  new_sync_write\n    ext4_file_write_iter\n      ext4_buffered_write_iter\n        generic_perform_write\n          ext4_da_write_begin\n            ext4_da_write_inline_data_begin -> If inline data size too\n            small will allocate block to write, then mapping will has\n            dirty page\n                ext4_da_convert_inline_data_to_extent ->clear EXT4_STATE_MAY_INLINE_DATA\n2. fallocate\ndo_vfs_ioctl\n  ioctl_preallocate\n    vfs_fallocate\n      ext4_fallocate\n        ext4_convert_inline_data\n          ext4_convert_inline_data_nolock\n            ext4_map_blocks -> fail will goto restore data\n            ext4_restore_inline_data\n              ext4_create_inline_data\n              ext4_write_inline_data\n              ext4_set_inode_state -> set inode EXT4_STATE_MAY_INLINE_DATA\n3. writepages\n__ext4_ioctl\n  ext4_alloc_da_blocks\n    filemap_flush\n      filemap_fdatawrite_wbc\n        do_writepages\n          ext4_writepages\n            if (ext4_has_inline_data(inode))\n              BUG_ON(ext4_test_inode_state(inode, EXT4_STATE_MAY_INLINE_DATA))\n\nThe root cause of this issue is we destory inline data until call\next4_writepages under delay allocation mode.  But there maybe already\nconvert from inline to extent.  To solve this issue, we call\nfilemap_flush first..",
  "datePublished": "Feb 26, 2025, 2:11:01 AM",
  "dateUpdated": "Feb 26, 2025, 2:11:01 AM",
  "baseScore": 0.0,
  "references": [
    "https://git.kernel.org/stable/c/19918ec7717d87d5ab825884a46b26b21375d7ce",
    "https://git.kernel.org/stable/c/b2b78f5bf2d453dda3903955efee059260787a42",
    "https://git.kernel.org/stable/c/de1732b5c1693ad489c5d254f124f67cb775f37d",
    "https://git.kernel.org/stable/c/73fd5b19285197078ee8a2e651d75d5b094a4de9",
    "https://git.kernel.org/stable/c/1b061af037646c9cdb0afd8a8d2f1e1c06285866",
    "https://git.kernel.org/stable/c/18a759f7f99f0b65a08ff5b7e745fc405a42bde4",
    "https://git.kernel.org/stable/c/1cde35417edc0370fb0179a4e38b78a15350a8d0",
    "https://git.kernel.org/stable/c/013f12bdedb96816aaa27ee04349f4433d361f52",
    "https://git.kernel.org/stable/c/ef09ed5d37b84d18562b30cf7253e57062d0db05"
  ],
  "aliases": [
    "CVE-2022-49347"
  ],
  "assigner": "Linux",
  "epss": 0.18,
  "enisaIdProduct": [
    {
      "id": "1f46eb3e-1bb4-3013-af62-97a5633d8c6a",
      "product": {
        "name": "Linux"
      },
      "product_version": "1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 <1b061af037646c9cdb0afd8a8d2f1e1c06285866"
    },
    {
      "id": "4ed4c5e9-a470-360d-bcfe-34aeb7eb7e51",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 5.15.46"
    },
    {
      "id": "6419e88f-e7b0-3222-bc2d-759f954bd089",
      "product": {
        "name": "Linux"
      },
      "product_version": "1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 <1cde35417edc0370fb0179a4e38b78a15350a8d0"
    },
    {
      "id": "64e6971d-c2f0-3b6e-aa87-995068a6190f",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 4.14.283"
    },
    {
      "id": "653c7b79-468d-3568-b4b3-70771e430528",
      "product": {
        "name": "Linux"
      },
      "product_version": "1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 <b2b78f5bf2d453dda3903955efee059260787a42"
    },
    {
      "id": "70598de7-b5cb-3b40-902b-63d753ec3e3a",
      "product": {
        "name": "Linux"
      },
      "product_version": "1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 <013f12bdedb96816aaa27ee04349f4433d361f52"
    },
    {
      "id": "76ef02e0-d617-389a-b023-b129e7df8778",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 4.9.318"
    },
    {
      "id": "7dbaf8bc-a35a-3a76-9cf1-e04b4f62ab25",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 4.19.247"
    },
    {
      "id": "9c0290dc-564a-3e06-8c2f-3e87b6e4d06b",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 5.18.3"
    },
    {
      "id": "a1da7f74-fe9b-3a46-a9dd-c2b967cfdd81",
      "product": {
        "name": "Linux"
      },
      "product_version": "1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 <de1732b5c1693ad489c5d254f124f67cb775f37d"
    },
    {
      "id": "b44cf784-6434-3145-8f84-ee8e4837c63e",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 5.17.14"
    },
    {
      "id": "b46c0cd9-3f57-3d72-8856-523e6f65dfba",
      "product": {
        "name": "Linux"
      },
      "product_version": "1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 <18a759f7f99f0b65a08ff5b7e745fc405a42bde4"
    },
    {
      "id": "c1b016f6-f1fe-3c20-87e4-06e44270a8a0",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 5.19"
    },
    {
      "id": "c6fdf53c-3c77-3f67-898c-c7b49381d1ba",
      "product": {
        "name": "Linux"
      },
      "product_version": "1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 <19918ec7717d87d5ab825884a46b26b21375d7ce"
    },
    {
      "id": "cdf34de2-cd71-3426-a43e-9423687e2e4c",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 5.4.198"
    },
    {
      "id": "d7268f55-9f13-3e96-9002-5efff0eb8009",
      "product": {
        "name": "Linux"
      },
      "product_version": "1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 <ef09ed5d37b84d18562b30cf7253e57062d0db05"
    },
    {
      "id": "d9108cd0-df8c-3015-8e42-e42b3466b3b2",
      "product": {
        "name": "Linux"
      },
      "product_version": "1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 <73fd5b19285197078ee8a2e651d75d5b094a4de9"
    },
    {
      "id": "dcb99706-db3c-3406-8553-cbae1bf28f85",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 5.10.121"
    }
  ],
  "enisaIdVendor": [
    {
      "id": "3944ae3d-7bd1-32a5-bcad-eead90c6b942",
      "vendor": {
        "name": "Linux"
      }
    }
  ],
  "cve": "CVE-2022-49347"
}

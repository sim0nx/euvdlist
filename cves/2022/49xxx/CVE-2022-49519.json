{
  "id": "EUVD-2022-54710",
  "description": "In the Linux kernel, the following vulnerability has been resolved:\n\nath10k: skip ath10k_halt during suspend for driver state RESTARTING\n\nDouble free crash is observed when FW recovery(caused by wmi\ntimeout/crash) is followed by immediate suspend event. The FW recovery\nis triggered by ath10k_core_restart() which calls driver clean up via\nath10k_halt(). When the suspend event occurs between the FW recovery,\nthe restart worker thread is put into frozen state until suspend completes.\nThe suspend event triggers ath10k_stop() which again triggers ath10k_halt()\nThe double invocation of ath10k_halt() causes ath10k_htt_rx_free() to be\ncalled twice(Note: ath10k_htt_rx_alloc was not called by restart worker\nthread because of its frozen state), causing the crash.\n\nTo fix this, during the suspend flow, skip call to ath10k_halt() in\nath10k_stop() when the current driver state is ATH10K_STATE_RESTARTING.\nAlso, for driver state ATH10K_STATE_RESTARTING, call\nath10k_wait_for_suspend() in ath10k_stop(). This is because call to\nath10k_wait_for_suspend() is skipped later in\n[ath10k_halt() > ath10k_core_stop()] for the driver state\nATH10K_STATE_RESTARTING.\n\nThe frozen restart worker thread will be cancelled during resume when the\ndevice comes out of suspend.\n\nBelow is the crash stack for reference:\n\n[  428.469167] ------------[ cut here ]------------\n[  428.469180] kernel BUG at mm/slub.c:4150!\n[  428.469193] invalid opcode: 0000 [#1] PREEMPT SMP NOPTI\n[  428.469219] Workqueue: events_unbound async_run_entry_fn\n[  428.469230] RIP: 0010:kfree+0x319/0x31b\n[  428.469241] RSP: 0018:ffffa1fac015fc30 EFLAGS: 00010246\n[  428.469247] RAX: ffffedb10419d108 RBX: ffff8c05262b0000\n[  428.469252] RDX: ffff8c04a8c07000 RSI: 0000000000000000\n[  428.469256] RBP: ffffa1fac015fc78 R08: 0000000000000000\n[  428.469276] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033\n[  428.469285] Call Trace:\n[  428.469295]  ? dma_free_attrs+0x5f/0x7d\n[  428.469320]  ath10k_core_stop+0x5b/0x6f\n[  428.469336]  ath10k_halt+0x126/0x177\n[  428.469352]  ath10k_stop+0x41/0x7e\n[  428.469387]  drv_stop+0x88/0x10e\n[  428.469410]  __ieee80211_suspend+0x297/0x411\n[  428.469441]  rdev_suspend+0x6e/0xd0\n[  428.469462]  wiphy_suspend+0xb1/0x105\n[  428.469483]  ? name_show+0x2d/0x2d\n[  428.469490]  dpm_run_callback+0x8c/0x126\n[  428.469511]  ? name_show+0x2d/0x2d\n[  428.469517]  __device_suspend+0x2e7/0x41b\n[  428.469523]  async_suspend+0x1f/0x93\n[  428.469529]  async_run_entry_fn+0x3d/0xd1\n[  428.469535]  process_one_work+0x1b1/0x329\n[  428.469541]  worker_thread+0x213/0x372\n[  428.469547]  kthread+0x150/0x15f\n[  428.469552]  ? pr_cont_work+0x58/0x58\n[  428.469558]  ? kthread_blkcg+0x31/0x31\n\nTested-on: QCA6174 hw3.2 PCI WLAN.RM.4.4.1-00288-QCARMSWPZ-1",
  "datePublished": "Feb 26, 2025, 2:13:45 AM",
  "dateUpdated": "Feb 26, 2025, 2:13:45 AM",
  "baseScore": 0.0,
  "references": [
    "https://git.kernel.org/stable/c/8aa3750986ffcf73e0692db3b40dd3a8e8c0c575",
    "https://git.kernel.org/stable/c/c2272428090d0d215a3f017cbbbad731c07eee53",
    "https://git.kernel.org/stable/c/7eb14cb604f49e58b7cf6faa87961a865a3c8649",
    "https://git.kernel.org/stable/c/5321e5211b5dc873e2e3d0deb749e69ecf4dbfe5",
    "https://git.kernel.org/stable/c/b72a4aff947ba807177bdabb43debaf2c66bee05"
  ],
  "aliases": [
    "CVE-2022-49519"
  ],
  "assigner": "Linux",
  "epss": 0.04,
  "enisaIdProduct": [
    {
      "id": "239d1f14-b434-378f-b640-1016b61ac187",
      "product": {
        "name": "Linux"
      },
      "product_version": "1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 <7eb14cb604f49e58b7cf6faa87961a865a3c8649"
    },
    {
      "id": "33002f5f-aceb-3298-af51-8f70acd7d33e",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 5.17.14"
    },
    {
      "id": "333321df-6173-3ae1-8cc5-6858493cf0af",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 5.19"
    },
    {
      "id": "a069e84d-ce47-3769-bbae-53dfd02c0ded",
      "product": {
        "name": "Linux"
      },
      "product_version": "1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 <b72a4aff947ba807177bdabb43debaf2c66bee05"
    },
    {
      "id": "afe14981-96c8-3ce2-a8c1-ae8cb7c777f7",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 5.15.46"
    },
    {
      "id": "b67930c3-c30d-3b7c-8704-590835ca426d",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 5.18.3"
    },
    {
      "id": "bf42bb19-1099-3c6f-b626-ca7f2313b50e",
      "product": {
        "name": "Linux"
      },
      "product_version": "1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 <5321e5211b5dc873e2e3d0deb749e69ecf4dbfe5"
    },
    {
      "id": "c8dd892c-4969-323a-82c6-ddba01c1a5ab",
      "product": {
        "name": "Linux"
      },
      "product_version": "1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 <8aa3750986ffcf73e0692db3b40dd3a8e8c0c575"
    },
    {
      "id": "d660fb83-a99d-33dd-9ddb-11d45a45f497",
      "product": {
        "name": "Linux"
      },
      "product_version": "1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 <c2272428090d0d215a3f017cbbbad731c07eee53"
    },
    {
      "id": "e99ed4e3-acd0-3c48-a627-dd7eaf89102d",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 5.10.121"
    }
  ],
  "enisaIdVendor": [
    {
      "id": "6d132b42-f1bf-309d-b9ff-1bb7cfa46567",
      "vendor": {
        "name": "Linux"
      }
    }
  ],
  "cve": "CVE-2022-49519"
}

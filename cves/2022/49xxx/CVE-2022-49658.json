{
  "id": "EUVD-2022-54574",
  "description": "In the Linux kernel, the following vulnerability has been resolved:\n\nbpf: Fix insufficient bounds propagation from adjust_scalar_min_max_vals\n\nKuee reported a corner case where the tnum becomes constant after the call\nto __reg_bound_offset(), but the register's bounds are not, that is, its\nmin bounds are still not equal to the register's max bounds.\n\nThis in turn allows to leak pointers through turning a pointer register as\nis into an unknown scalar via adjust_ptr_min_max_vals().\n\nBefore:\n\n  func#0 @0\n  0: R1=ctx(off=0,imm=0,umax=0,var_off=(0x0; 0x0)) R10=fp(off=0,imm=0,umax=0,var_off=(0x0; 0x0))\n  0: (b7) r0 = 1                        ; R0_w=scalar(imm=1,umin=1,umax=1,var_off=(0x1; 0x0))\n  1: (b7) r3 = 0                        ; R3_w=scalar(imm=0,umax=0,var_off=(0x0; 0x0))\n  2: (87) r3 = -r3                      ; R3_w=scalar()\n  3: (87) r3 = -r3                      ; R3_w=scalar()\n  4: (47) r3 |= 32767                   ; R3_w=scalar(smin=-9223372036854743041,umin=32767,var_off=(0x7fff; 0xffffffffffff8000),s32_min=-2147450881)\n  5: (75) if r3 s>= 0x0 goto pc+1       ; R3_w=scalar(umin=9223372036854808575,var_off=(0x8000000000007fff; 0x7fffffffffff8000),s32_min=-2147450881,u32_min=32767)\n  6: (95) exit\n\n  from 5 to 7: R0=scalar(imm=1,umin=1,umax=1,var_off=(0x1; 0x0)) R1=ctx(off=0,imm=0,umax=0,var_off=(0x0; 0x0)) R3=scalar(umin=32767,umax=9223372036854775807,var_off=(0x7fff; 0x7fffffffffff8000),s32_min=-2147450881) R10=fp(off=0,imm=0,umax=0,var_off=(0x0; 0x0))\n  7: (d5) if r3 s<= 0x8000 goto pc+1    ; R3=scalar(umin=32769,umax=9223372036854775807,var_off=(0x7fff; 0x7fffffffffff8000),s32_min=-2147450881,u32_min=32767)\n  8: (95) exit\n\n  from 7 to 9: R0=scalar(imm=1,umin=1,umax=1,var_off=(0x1; 0x0)) R1=ctx(off=0,imm=0,umax=0,var_off=(0x0; 0x0)) R3=scalar(umin=32767,umax=32768,var_off=(0x7fff; 0x8000)) R10=fp(off=0,imm=0,umax=0,var_off=(0x0; 0x0))\n  9: (07) r3 += -32767                  ; R3_w=scalar(imm=0,umax=1,var_off=(0x0; 0x0))  <--- [*]\n  10: (95) exit\n\nWhat can be seen here is that R3=scalar(umin=32767,umax=32768,var_off=(0x7fff;\n0x8000)) after the operation R3 += -32767 results in a 'malformed' constant, that\nis, R3_w=scalar(imm=0,umax=1,var_off=(0x0; 0x0)). Intersecting with var_off has\nnot been done at that point via __update_reg_bounds(), which would have improved\nthe umax to be equal to umin.\n\nRefactor the tnum <> min/max bounds information flow into a reg_bounds_sync()\nhelper and use it consistently everywhere. After the fix, bounds have been\ncorrected to R3_w=scalar(imm=0,umax=0,var_off=(0x0; 0x0)) and thus the register\nis regarded as a 'proper' constant scalar of 0.\n\nAfter:\n\n  func#0 @0\n  0: R1=ctx(off=0,imm=0,umax=0,var_off=(0x0; 0x0)) R10=fp(off=0,imm=0,umax=0,var_off=(0x0; 0x0))\n  0: (b7) r0 = 1                        ; R0_w=scalar(imm=1,umin=1,umax=1,var_off=(0x1; 0x0))\n  1: (b7) r3 = 0                        ; R3_w=scalar(imm=0,umax=0,var_off=(0x0; 0x0))\n  2: (87) r3 = -r3                      ; R3_w=scalar()\n  3: (87) r3 = -r3                      ; R3_w=scalar()\n  4: (47) r3 |= 32767                   ; R3_w=scalar(smin=-9223372036854743041,umin=32767,var_off=(0x7fff; 0xffffffffffff8000),s32_min=-2147450881)\n  5: (75) if r3 s>= 0x0 goto pc+1       ; R3_w=scalar(umin=9223372036854808575,var_off=(0x8000000000007fff; 0x7fffffffffff8000),s32_min=-2147450881,u32_min=32767)\n  6: (95) exit\n\n  from 5 to 7: R0=scalar(imm=1,umin=1,umax=1,var_off=(0x1; 0x0)) R1=ctx(off=0,imm=0,umax=0,var_off=(0x0; 0x0)) R3=scalar(umin=32767,umax=9223372036854775807,var_off=(0x7fff; 0x7fffffffffff8000),s32_min=-2147450881) R10=fp(off=0,imm=0,umax=0,var_off=(0x0; 0x0))\n  7: (d5) if r3 s<= 0x8000 goto pc+1    ; R3=scalar(umin=32769,umax=9223372036854775807,var_off=(0x7fff; 0x7fffffffffff8000),s32_min=-2147450881,u32_min=32767)\n  8: (95) exit\n\n  from 7 to 9: R0=scalar(imm=1,umin=1,umax=1,var_off=(0x1; 0x0)) R1=ctx(off=0,imm=0,umax=0,var_off=(0x0; 0x0)) R3=scalar(umin=32767,umax=32768,var_off=(0x7fff; 0x8000)) R10=fp(off=0\n---truncated---",
  "datePublished": "Feb 26, 2025, 2:23:56 AM",
  "dateUpdated": "Feb 26, 2025, 2:23:56 AM",
  "baseScore": 0.0,
  "references": [
    "https://git.kernel.org/stable/c/e917be1f83ea14a68b3cf64d3da9968eaf991dae",
    "https://git.kernel.org/stable/c/a7de8d436db92bab8b1f44624297c2554a6ac36b",
    "https://git.kernel.org/stable/c/b2a28bb36664c94375926cbbb91976242847699d",
    "https://git.kernel.org/stable/c/3844d153a41adea718202c10ae91dc96b37453b5"
  ],
  "aliases": [
    "CVE-2022-49658"
  ],
  "assigner": "Linux",
  "epss": 0.13,
  "enisaIdProduct": [
    {
      "id": "08696e02-307b-36ba-b86a-c0d64d3adbb9",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 5.18.11"
    },
    {
      "id": "5d9b88ea-6904-3480-82fd-dc976c2db9ae",
      "product": {
        "name": "Linux"
      },
      "product_version": "b03c9f9fdc37dab81ea04d5dacdc5995d4c224c2 <b2a28bb36664c94375926cbbb91976242847699d"
    },
    {
      "id": "635209ed-fd6e-3d42-ae82-a20107e539db",
      "product": {
        "name": "Linux"
      },
      "product_version": "b03c9f9fdc37dab81ea04d5dacdc5995d4c224c2 <e917be1f83ea14a68b3cf64d3da9968eaf991dae"
    },
    {
      "id": "704070cc-e867-3a6a-8ce2-41a1533a08e4",
      "product": {
        "name": "Linux"
      },
      "product_version": "b03c9f9fdc37dab81ea04d5dacdc5995d4c224c2 <3844d153a41adea718202c10ae91dc96b37453b5"
    },
    {
      "id": "863b4976-f1f0-348f-98bf-00ef8a4abc02",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 5.19"
    },
    {
      "id": "a2a03283-3863-3068-9f4c-d61e85863c6e",
      "product": {
        "name": "Linux"
      },
      "product_version": "b03c9f9fdc37dab81ea04d5dacdc5995d4c224c2 <a7de8d436db92bab8b1f44624297c2554a6ac36b"
    },
    {
      "id": "c8c1b429-c0b6-3522-abc8-7c6ae317bdea",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 5.15.54"
    },
    {
      "id": "cc7b92b9-81b0-3d85-80e4-862af0311e94",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 5.10.130"
    },
    {
      "id": "e82e00aa-1789-323e-babe-75c20b1cce7a",
      "product": {
        "name": "Linux"
      },
      "product_version": "patch: 0"
    },
    {
      "id": "f4601d0a-8a87-3b37-9092-5f1d84cde82f",
      "product": {
        "name": "Linux"
      },
      "product_version": "4.14"
    }
  ],
  "enisaIdVendor": [
    {
      "id": "d96552b5-a39c-3f38-944d-1e0917838807",
      "vendor": {
        "name": "Linux"
      }
    }
  ],
  "cve": "CVE-2022-49658"
}

{
  "id": "EUVD-2023-59689",
  "description": "In the Linux kernel, the following vulnerability has been resolved:\n\npowerpc/imc-pmu: Fix use of mutex in IRQs disabled section\n\nCurrent imc-pmu code triggers a WARNING with CONFIG_DEBUG_ATOMIC_SLEEP\nand CONFIG_PROVE_LOCKING enabled, while running a thread_imc event.\n\nCommand to trigger the warning:\n  # perf stat -e thread_imc/CPM_CS_FROM_L4_MEM_X_DPTEG/ sleep 5\n\n   Performance counter stats for 'sleep 5':\n\n                   0      thread_imc/CPM_CS_FROM_L4_MEM_X_DPTEG/\n\n         5.002117947 seconds time elapsed\n\n         0.000131000 seconds user\n         0.001063000 seconds sys\n\nBelow is snippet of the warning in dmesg:\n\n  BUG: sleeping function called from invalid context at kernel/locking/mutex.c:580\n  in_atomic(): 1, irqs_disabled(): 1, non_block: 0, pid: 2869, name: perf-exec\n  preempt_count: 2, expected: 0\n  4 locks held by perf-exec/2869:\n   #0: c00000004325c540 (&sig->cred_guard_mutex){+.+.}-{3:3}, at: bprm_execve+0x64/0xa90\n   #1: c00000004325c5d8 (&sig->exec_update_lock){++++}-{3:3}, at: begin_new_exec+0x460/0xef0\n   #2: c0000003fa99d4e0 (&cpuctx_lock){-...}-{2:2}, at: perf_event_exec+0x290/0x510\n   #3: c000000017ab8418 (&ctx->lock){....}-{2:2}, at: perf_event_exec+0x29c/0x510\n  irq event stamp: 4806\n  hardirqs last  enabled at (4805): [<c000000000f65b94>] _raw_spin_unlock_irqrestore+0x94/0xd0\n  hardirqs last disabled at (4806): [<c0000000003fae44>] perf_event_exec+0x394/0x510\n  softirqs last  enabled at (0): [<c00000000013c404>] copy_process+0xc34/0x1ff0\n  softirqs last disabled at (0): [<0000000000000000>] 0x0\n  CPU: 36 PID: 2869 Comm: perf-exec Not tainted 6.2.0-rc2-00011-g1247637727f2 #61\n  Hardware name: 8375-42A POWER9 0x4e1202 opal:v7.0-16-g9b85f7d961 PowerNV\n  Call Trace:\n    dump_stack_lvl+0x98/0xe0 (unreliable)\n    __might_resched+0x2f8/0x310\n    __mutex_lock+0x6c/0x13f0\n    thread_imc_event_add+0xf4/0x1b0\n    event_sched_in+0xe0/0x210\n    merge_sched_in+0x1f0/0x600\n    visit_groups_merge.isra.92.constprop.166+0x2bc/0x6c0\n    ctx_flexible_sched_in+0xcc/0x140\n    ctx_sched_in+0x20c/0x2a0\n    ctx_resched+0x104/0x1c0\n    perf_event_exec+0x340/0x510\n    begin_new_exec+0x730/0xef0\n    load_elf_binary+0x3f8/0x1e10\n  ...\n  do not call blocking ops when !TASK_RUNNING; state=2001 set at [<00000000fd63e7cf>] do_nanosleep+0x60/0x1a0\n  WARNING: CPU: 36 PID: 2869 at kernel/sched/core.c:9912 __might_sleep+0x9c/0xb0\n  CPU: 36 PID: 2869 Comm: sleep Tainted: G        W          6.2.0-rc2-00011-g1247637727f2 #61\n  Hardware name: 8375-42A POWER9 0x4e1202 opal:v7.0-16-g9b85f7d961 PowerNV\n  NIP:  c000000000194a1c LR: c000000000194a18 CTR: c000000000a78670\n  REGS: c00000004d2134e0 TRAP: 0700   Tainted: G        W           (6.2.0-rc2-00011-g1247637727f2)\n  MSR:  9000000000021033 <SF,HV,ME,IR,DR,RI,LE>  CR: 48002824  XER: 00000000\n  CFAR: c00000000013fb64 IRQMASK: 1\n\nThe above warning triggered because the current imc-pmu code uses mutex\nlock in interrupt disabled sections. The function mutex_lock()\ninternally calls __might_resched(), which will check if IRQs are\ndisabled and in case IRQs are disabled, it will trigger the warning.\n\nFix the issue by changing the mutex lock to spinlock.\n\n[mpe: Fix comments, trim oops in change log, add reported-by tags]",
  "datePublished": "Mar 27, 2025, 4:43:59 PM",
  "dateUpdated": "Mar 27, 2025, 4:43:59 PM",
  "baseScore": 0.0,
  "references": [
    "https://git.kernel.org/stable/c/d0c6d2a31026102d4738b47a610bed4401b9834f",
    "https://git.kernel.org/stable/c/8cbeb60320ac45a8240b561c8ef466b86c34dedc",
    "https://git.kernel.org/stable/c/a90d339f1f66be4a946769b565668e2bd0686dfa",
    "https://git.kernel.org/stable/c/424bcb570cb320d1d15238cd4c933522b90f78fa",
    "https://git.kernel.org/stable/c/76d588dddc459fefa1da96e0a081a397c5c8e216"
  ],
  "aliases": [
    "CVE-2023-53031"
  ],
  "assigner": "Linux",
  "epss": 0.03,
  "enisaIdProduct": [
    {
      "id": "00e01d33-ee3e-38df-b0b4-7554d597c002",
      "product": {
        "name": "Linux"
      },
      "product_version": "8f95faaac56c18b32d0e23ace55417a440abdb7e <76d588dddc459fefa1da96e0a081a397c5c8e216"
    },
    {
      "id": "1b1551f1-4d57-3f12-9511-4966d702bd1d",
      "product": {
        "name": "Linux"
      },
      "product_version": "8f95faaac56c18b32d0e23ace55417a440abdb7e <d0c6d2a31026102d4738b47a610bed4401b9834f"
    },
    {
      "id": "593b562d-d096-334e-97b9-c94da566432c",
      "product": {
        "name": "Linux"
      },
      "product_version": "8f95faaac56c18b32d0e23ace55417a440abdb7e <8cbeb60320ac45a8240b561c8ef466b86c34dedc"
    },
    {
      "id": "6bb61e76-95fb-361d-9526-b04d6c40b94f",
      "product": {
        "name": "Linux"
      },
      "product_version": "8f95faaac56c18b32d0e23ace55417a440abdb7e <424bcb570cb320d1d15238cd4c933522b90f78fa"
    },
    {
      "id": "6e2954ae-ab35-3150-be64-124f6f27d222",
      "product": {
        "name": "Linux"
      },
      "product_version": "4.14"
    },
    {
      "id": "7a33d56c-9a18-3c7a-a57e-9ba3a7e5706c",
      "product": {
        "name": "Linux"
      },
      "product_version": "8f95faaac56c18b32d0e23ace55417a440abdb7e <a90d339f1f66be4a946769b565668e2bd0686dfa"
    }
  ],
  "enisaIdVendor": [
    {
      "id": "7914df9e-1333-3ccf-9481-0a7b71c0c13b",
      "vendor": {
        "name": "Linux"
      }
    }
  ],
  "cve": "CVE-2023-53031"
}
